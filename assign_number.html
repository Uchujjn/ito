<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>assign_number</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="card" id="topic">お題：</div>
    <h1 id="player">プレイヤー名</h1>
    <h2>数字を確認してください</h2>
    <div class="card" id="number">数字</div>
    <button id="showHide">表示/非表示</button>
    <button id="nextPlayer">次の人へ</button>

<script>
    let topic = localStorage.getItem("topic");
    let players = JSON.parse(localStorage.getItem("players"));
    let everyNumber = new Array(players.length);
    let numberHidden = true;

    let index = 0;
    function generateRondomNumber(){
        let number;
        do{
            number = Math.floor(Math.random()*101);
        } while(everyNumber.includes(number));
        return number;
    }

    function updateNumberDisplay(number) {
        document.getElementById("number").textContent = numberHidden ? "??" : number;
    }

    function showPlayer(){
        if(index >= players.length){
            //全員おわったら次の画面へ遷移
            saveNumbers();
            location.href = "discussion.html";
            return;
        }
        
        document.getElementById("topic").textContent = "お題：" + topic;    //お題を表示
        document.getElementById("player").textContent = players[index] + "さん";    //プレイヤー名を表示

        if(!everyNumber[index]) {
            everyNumber[index] = generateRondomNumber();
        }

        updateNumberDisplay(everyNumber[index]);
    }

    function saveNumbers(){
        localStorage.setItem("numbers", JSON.stringify(everyNumber));
    }

    //初期表示
    showPlayer();

    //表示・非表示ボタンを押したら
    document.getElementById("showHide").addEventListener("click", () => {
        numberHidden = !numberHidden;
        updateNumberDisplay(everyNumber[index]);
    });

    //次の人へボタンを押したら
    document.getElementById("nextPlayer").addEventListener("click", () => {
        index++;
        numberHidden = true;
        if(index === players.length -1){
            document.getElementById("nextPlayer").textContent = "議論開始";
        }
        showPlayer();
    });
    
</script>
</body>
</html>


