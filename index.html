<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ito</title>
<style>
    body {
        font-family: sans-serif;
        text-align: center;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
    }
    h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
    }
    .card {
        font-size: 2.5rem;
        background: white;
        padding: 30px;
        margin: 10px auto;
        width: 80%;
        max-width: 300px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    button {
        font-size: 1.2rem;
        padding: 15px 25px;
        margin: 10px;
        border: none;
        border-radius: 8px;
        background: #007bff;
        color: white;
        cursor: pointer;
        width: 80%;
        max-width: 300px;
    }
    button:active {
        background: #0056b3;
    }
    input[type="number"] {
        font-size: 1.5rem;
        padding: 10px;
        width: 60%;
        margin-top: 10px;
        text-align: center;
    }
    .info {
        font-size: 1.2rem;
        margin: 15px 0;
    }
</style>
</head>
<body>

<h1>ito</h1>

<div class="card" id="topic">読み込み中...</div>
<div class="card" id="number">??</div>

<button id="toggleNumber">数字を表示 / 隠す</button>
<button id="changeTopic">お題を変更</button>

<div>
    <input type="number" id="guess" placeholder="予想数字" min="0" max="100">
    <button id="submitGuess">確定</button>
</div>

<div class="info">
    <div>第<span id="round">1</span>ラウンド</div>
    <div>残りライフ: <span id="score">100</span></div>
    <div>前問の予想: <span id="preAnswer">0</span></div>
    <div>前問の正解: <span id="preNumber">0</span></div>
    
</div>

<button id="resetGame" style="background:#dc3545;">リセット</button>

<script>
let topics = [];
let currentNumber = 0;
let preNumber = 0;
let preAnswer = 0;
let isNumberHidden = true;
let round = 1;
let score = 100;

// JSONからお題読み込み
fetch("topics.json")
    .then(res => res.json())
    .then(data => {
        topics = data;
        setNewTopicAndNumber();
    });

function setNewTopicAndNumber() {
    const randomTopic = topics[Math.floor(Math.random() * topics.length)];
    currentNumber = Math.floor(Math.random() * 101);
    document.getElementById("topic").textContent = randomTopic;
    isNumberHidden = true;
    updateNumberDisplay();
}

function updateNumberDisplay() {
    document.getElementById("number").textContent = isNumberHidden ? "??" : currentNumber;
}

// 数字カードの裏表切り替え
document.getElementById("toggleNumber").addEventListener("click", () => {
    isNumberHidden = !isNumberHidden;
    updateNumberDisplay();
});

// お題変更ボタン
document.getElementById("changeTopic").addEventListener("click", () => {
    setNewTopicAndNumber();
});

// 確定ボタン
document.getElementById("submitGuess").addEventListener("click", () => {
    const guessValue = parseInt(document.getElementById("guess").value, 10);
    if (isNaN(guessValue) || guessValue < 0 || guessValue > 100) {
        alert("0〜100の数字を入力してください");
        return;
    }
    const diff = Math.abs(currentNumber - guessValue);
    score -= diff;
    if (score < 0) score = 0;
    round++;
    preAnswer = guessValue;
    preNumber = currentNumber;
    document.getElementById("round").textContent = round;
    document.getElementById("score").textContent = score;
    document.getElementById("preAnswer").textContent = preAnswer;
    document.getElementById("preNumber").textContent = preNumber;
    document.getElementById("guess").value = "";
    setNewTopicAndNumber();
});

// リセットボタン
document.getElementById("resetGame").addEventListener("click", () => {
    round = 1;
    score = 100;
    preAnswer = 0;
    preNumber = 0;
    document.getElementById("round").textContent = round;
    document.getElementById("score").textContent = score;
    document.getElementById("preAnswer").textContent = preAnswer;
    document.getElementById("preNumber").textContent = preNumber;
    setNewTopicAndNumber();
});
</script>

</body>
</html>
